{"version":3,"sources":["config/Widgets.ts","utils/helper.ts","config/Routes.ts","utils/messenger.ts","embed.ts"],"names":[],"mappings":"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","file":"embed.js","sourceRoot":"../src","sourcesContent":["export const EMBED_SCRIPT = `<script async src=\"${process.env.EMBED_URL}/embed.js\"></script>`\nexport const EXAMPLE_TRIP = 'https://www.outguided.com/experiences/24-hours-in-browns-canyon-deluxe-overnight-camping-experience-like-nothing-out-there-granite'","import { EMBED_SCRIPT } from 'src/config/Widgets'\nimport { SnippetLinkFunction } from 'src/types'\n\nexport const escapeRegExp = (string: string) => string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')\n\nexport const getSnippetLink: SnippetLinkFunction = (url, label = 'Powered by outguided.com', { data = {}, withEmbedCode } = {}) => {\n  const attributeString = Object.keys({ ...data, widget: '' })\n    .map((key) => ` data-og-${key}${data[key] ? `=\"${data[key]}\"` : ''}`)\n    .join('')\n  return `<a href=\"${url}\"${attributeString}>${label}</a>${withEmbedCode ? EMBED_SCRIPT : ''}`\n}\n\nexport const getId = () => String(Date.now().toString(32) + Math.random().toString(16)).replace(/\\./g, '')\n","import { escapeRegExp } from 'src/utils/helper'\n\nexport const TRIP_PAGE = '/experiences/:slug'\nexport const HOST_PAGE = '/guides/:slug'\nexport const getTripSlugFromUrl = (url: string) => url.match(new RegExp(`^${escapeRegExp(getExternalUrl())}${TRIP_PAGE.replace(':slug', '([^/\\?]+)')}`))?.[1]\nexport const getHostSlugFromUrl = (url: string) => url.match(new RegExp(`^${escapeRegExp(getExternalUrl())}${HOST_PAGE.replace(':slug', '([^/\\?]+)')}`))?.[1]\nexport const tripLink = (slug?: string) => TRIP_PAGE.replace(':slug', slug ?? '')\nexport const hostLink = (slug?: string) => HOST_PAGE.replace(':slug', slug ?? '')\nexport const getEmbedPath = (path: string) => `/embed${path}`\nexport const getEmbedSnippetPath = (path: string) => `/code${path}`\nexport const getEmbedUrl = (path?: string) => `${process.env.EMBED_URL}${path ? `/#${getEmbedPath(path)}` : ''}`\nexport const getEmbedSnippetUrl = (path?: string) => `${process.env.EMBED_URL}${path ? `/#${getEmbedSnippetPath(path)}` : ''}`\nexport const getExternalUrl = (path: string = '') => `${process.env.SITE_URL}${path}`\n","import { MessageListenerCallback, MessageSender } from 'src/types'\n\nexport const send: MessageSender = (data, options) => {\n  const { target, targetOrigin = '*' } = options ?? {}\n  ;(target || window).postMessage(data, targetOrigin)\n}\n\nexport const register = (listener: MessageListenerCallback) => {\n  window.addEventListener('message', listener, false)\n}\n\nexport const unregister = (listener: MessageListenerCallback) => {\n  window.removeEventListener('message', listener, false)\n}\n","import { getEmbedSnippetUrl, getEmbedUrl, getExternalUrl, getHostSlugFromUrl, getTripSlugFromUrl, hostLink, tripLink } from './config/Routes'\nimport { EmbedMessage, EmbedSizeMessage, MessageListenerCallback } from './types'\nimport { getId } from './utils/helper'\nimport { register } from './utils/messenger'\ndeclare global {\n  interface Window {\n    OGWidgets: {\n      processedWidgets: HTMLAnchorElement[]\n      listenerCallbacks: MessageListenerCallback[]\n      listenerRegistered: boolean\n      registerListener: () => void\n      getWidgetCallbackUrl: (element: HTMLAnchorElement) => string | undefined\n      createIframe: (src: string) => HTMLIFrameElement\n      initializeWidget: (element: HTMLAnchorElement) => void\n      addListenerCallback: (listener: MessageListenerCallback) => void\n      getWidgetListenerCallback: (iframe: HTMLIFrameElement) => MessageListenerCallback\n      init: () => void\n    }\n  }\n}\nconst IFRAME_STYLES = {\n  border: 'none',\n  width: '0px',\n  height: '0px',\n  'overflow-x': 'hidden',\n  'overflow-y': 'hidden',\n  display: 'block',\n} as { [key: string]: string }\n\nconst IFRAME_ATTRIBUTES = {\n  scrolling: 'no',\n  frameborder: '0',\n  allowtransparency: 'true',\n  allowfullscreen: 'true',\n} as { [key: string]: string }\n\n;(function (window) {\n  const OGWidgets = {\n    processedWidgets: [],\n    listenerCallbacks: [],\n    listenerRegistered: false,\n    init: function () {\n      this.registerListener()\n      const widgets = document.querySelectorAll(`a[data-og-widget][href^=\"${getExternalUrl()}\"]`) as NodeListOf<HTMLAnchorElement>\n      widgets.forEach(this.initializeWidget.bind(this))\n    },\n\n    registerListener: function () {\n      if (!this.listenerRegistered) {\n        register((ev) => {\n          this.listenerCallbacks.forEach((listener) => listener(ev))\n        })\n        this.listenerRegistered = true\n      }\n    },\n    addListenerCallback: function (listener) {\n      this.listenerCallbacks.push(listener)\n    },\n    initializeWidget: function (element) {\n      if (this.processedWidgets.includes(element)) {\n        return\n      }\n      this.processedWidgets.push(element)\n\n      const url = this.getWidgetCallbackUrl(element)\n      if (!url) {\n        return\n      }\n\n      const iframe = this.createIframe(url)\n\n      iframe.onload = () => {\n        element.remove()\n      }\n      // if (element.dataset.ogCode) {\n      //   iframe.allow = `clipboard-write self ${getEmbedUrl()}`\n      // }\n      element.after(iframe)\n      this.addListenerCallback(this.getWidgetListenerCallback(iframe))\n    },\n    getWidgetCallbackUrl: function (element) {\n      let url\n      const {\n        href,\n        dataset: { ogCode },\n      } = element\n      if (getTripSlugFromUrl(href)) {\n        url = tripLink(getTripSlugFromUrl(href))\n      } else if (getHostSlugFromUrl(href)) {\n        url = hostLink(getHostSlugFromUrl(href))\n      }\n      return url ? (typeof ogCode !== 'undefined' ? getEmbedSnippetUrl(url) : getEmbedUrl(url)) : null\n    },\n    createIframe: function (src) {\n      let iframe: HTMLIFrameElement\n      try {\n        iframe = document.createElement('<iframe name=\"' + getId() + '\"></iframe>') as HTMLIFrameElement\n      } catch (e) {\n        iframe = document.createElement('iframe')\n        iframe.name = getId()\n      }\n\n      iframe.src = src\n      Object.keys(IFRAME_ATTRIBUTES).forEach((attribute) => iframe.setAttribute(attribute, IFRAME_ATTRIBUTES[attribute]))\n      Object.keys(IFRAME_STYLES).forEach((style) => iframe.style.setProperty(style, IFRAME_STYLES[style]))\n      return iframe\n    },\n    getWidgetListenerCallback: function (iframe) {\n      return (event) => {\n        const {\n          origin,\n          data: { type, name },\n        } = event as MessageEvent<EmbedMessage>\n\n        if (getEmbedUrl().startsWith(origin) && iframe.name === name) {\n          switch (type) {\n            case 'size':\n              const { width, height } = event.data as EmbedSizeMessage\n              iframe.style.height = height + 'px'\n              iframe.style.width = width + 'px'\n              break\n            default:\n              console.log(event.data)\n              break\n          }\n        }\n      }\n    },\n  } as Window['OGWidgets']\n\n  if (!window.OGWidgets) {\n    OGWidgets.init()\n    window.onload = () => OGWidgets.init()\n    window.OGWidgets = OGWidgets\n  }\n})(window)\n"]}